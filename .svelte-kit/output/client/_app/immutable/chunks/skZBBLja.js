import{B as u}from"./Ddzy9yRd.js";function f(){const{subscribe:l,set:o,update:n}=u({messages:[],isLoading:!1,isOpen:!1});return{subscribe:l,addMessage:e=>n(t=>({...t,messages:[...t.messages,e]})),setLoading:e=>n(t=>({...t,isLoading:e})),toggleChat:()=>n(e=>({...e,isOpen:!e.isOpen})),closeChat:()=>n(e=>({...e,isOpen:!1})),reset:()=>o({messages:[],isLoading:!1,isOpen:!1})}}const S=f();function g(){const l=typeof window<"u"?localStorage.getItem("authToken"):null,o=typeof window<"u"?localStorage.getItem("authUser"):null,{subscribe:n,set:e,update:t}=u({user:o?JSON.parse(o):null,token:l,isAuthenticated:!!l,isLoading:!1});return{subscribe:n,login:async(i,c)=>{t(s=>({...s,isLoading:!0}));try{const s=await fetch("http://localhost:3500/api/login",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:i,password:c})});if(!s.ok){const d=await s.json();throw new Error(d.error||"Login failed")}const r=(await s.json()).user;return localStorage.setItem("authToken","authenticated"),localStorage.setItem("authUser",JSON.stringify(r)),e({user:r,token:"authenticated",isAuthenticated:!0,isLoading:!1}),{success:!0}}catch(s){return t(a=>({...a,isLoading:!1})),{success:!1,error:s.message}}},register:async(i,c,s)=>{t(a=>({...a,isLoading:!0}));try{const a=await fetch("http://localhost:3500/api/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:i,email:c,password:s})});if(!a.ok){const r=await a.json();throw new Error(r.error||"Registration failed")}return t(r=>({...r,isLoading:!1})),{success:!0}}catch(a){return t(r=>({...r,isLoading:!1})),{success:!1,error:a.message}}},logout:()=>{localStorage.removeItem("authToken"),localStorage.removeItem("authUser"),e({user:null,token:null,isAuthenticated:!1,isLoading:!1})},checkAuth:async()=>localStorage.getItem("authToken")?!0:(e({user:null,token:null,isAuthenticated:!1,isLoading:!1}),!1)}}const m=g();function h(){const{subscribe:l,set:o,update:n}=u(null);return{subscribe:l,loadPortfolio:async e=>{try{let t="http://localhost:3500/api/portfolio/";if(e)t+=e;else{o(null);return}const i=await fetch(t);if(i.ok){const c=await i.json();return o(c),c}else o(null)}catch(t){console.error("Failed to load portfolio:",t),o(null)}},clear:()=>o(null),set:o}}const w=h();export{m as a,S as c,w as p};
